(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{1087:function(e,t,n){},844:function(e,t,n){"use strict";n.r(t);var a,o=n(0),E=n.n(o),r=n(7),i=(n(8),n(6)),s=n(107),C=n.n(s),m=n(34),c=n(9),D=n.n(c),l=n(279),L=n.n(l),O=(n(303),n(23),n(137)),k=n.n(O),S=n(2),d=n(721),u=n(18);n(5),n(1087);function h(e){return(h="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function p(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}function f(e){return(f=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t){return(b=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}var v=Object(i.translate)("translations")(a=Object(r.connect)(function(e){return{isLoggedIn:e.auth.loggedIn,token:e.auth.token,customer:e.auth.customer,lang:e.config.lang,router:e.router}},{updateCustomer:u.h,replaceAddress:u.b})(a=function(e){function o(e){var t,n,a;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,o),n=this,(t=!(a=f(o).call(this,e))||"object"!==h(a)&&"function"!=typeof a?g(n):a).state={phone:e.customer.phone||"",name:e.customer.name||"",email:e.customer.email||"",gender:e.customer.gender||1,originDob:e.customer.dob||"",dob:e.customer.dob||"",otp:"",phoneChanged:!1,verifying:!1,otpSending:!1,countryCode:e.customer.country_code,countriesListShow:!1,genderOpened:!1,error:{}},t.handleClickOutside=t.handleClickOutside.bind(g(g(t))),t.handleInputChange=t.handleInputChange.bind(g(g(t))),t.onUpdateDetail=t.onUpdateDetail.bind(g(g(t))),t.showGender=t.showGender.bind(g(g(t))),t.onDobChange=t.onDobChange.bind(g(g(t))),t.formatDate="D/M/YYYY",t.formatDateApi="YYYY-MM-DD",t.timeout=null,t.inputTimeout=null,t}var t,n,a;return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&b(e,t)}(o,E.a.Component),t=o,(n=[{key:"componentDidMount",value:function(){document.addEventListener("mousedown",this.handleClickOutside),this.getCustomerInfo()}},{key:"componentDidUpdate",value:function(e){this.props.customer.phone!==e.customer.phone&&this.setState({phone:this.props.customer.phone}),this.props.customer.name!==e.customer.name&&this.setState({name:this.props.customer.name}),this.props.customer.email!==e.customer.email&&this.setState({email:this.props.customer.email})}},{key:"componentWillUnmount",value:function(){document.removeEventListener("mousedown",this.handleClickOutside)}},{key:"getCustomerInfo",value:function(){var e=this.props,t=e.token,n=e.updateCustomer,a=e.replaceAddress;Object(d.f)(t).then(function(e){e&&!e.error&&(n({name:e.data.name,phone:e.data.phone,email:e.data.email,dob:e.data.dob,country_code:e.data.country_code}),a(e.data.addresses))})}},{key:"handleClickOutside",value:function(e){!this.countriesRef||this.countriesRef.contains(e.target)||this.countryToggle.contains(e.target)||this.setState({countriesListShow:!1}),!this.genderRef||this.genderRef.contains(e.target)||this.genderInputRef.contains(e.target)||this.setState({genderOpened:!1})}},{key:"handleInputChange",value:function(e){var t,n,a,o=this,r=this.props.t,i=e.target,s=i.value,c=i.name;if(("phone"===c||"otp"===c)&&""!==s&&!/^[0-9\b]+$/.test(s))return!1;this.inputTimeout&&clearTimeout(this.inputTimeout),this.inputTimeout=setTimeout(function(){"email"===c&&(""!==s&&o.validateEmail(s)?o.setState({error:{}}):o.setState({error:{email:r("LABEL.INVALID_EMAIL")}}))},250),"phone"===c&&this.setState({phoneChanged:!0}),this.setState((a=s,(n=c)in(t={})?Object.defineProperty(t,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[n]=a,t))}},{key:"validateEmail",value:function(e){return/^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,3})+$/.test(String(e).toLowerCase())}},{key:"toggleCountriesList",value:function(){this.setState({countriesListShow:!this.state.countriesListShow})}},{key:"changeCountryCode",value:function(e){this.state.countryCode!==e&&(this.setState({countryCode:e}),this.toggleCountriesList())}},{key:"sendOtp",value:function(){var t=this,e=this.state,n=e.countryCode,a=e.phone;if(!e.otpSending){this.setState({otpSending:!0});var o=this.props,r=o.t,i=o.token,s={country_code:n,phone:a};Object(d.j)(s,i).then(function(e){e&&!e.error&&(m.toast.info(r("TOAST.Request_OTP_OK")),t.setState({phoneChanged:!1}))}).catch(function(e){m.toast.error(Object(S.n)(e.message))})}}},{key:"verify",value:function(){var t=this,e=this.state,n=e.countryCode,a=e.phone,o=e.otp;if(!e.verifying){this.setState({verifying:!0});var r=this.props,i=r.t,s=r.token,c={country_code:n,verification_code:o,phone:a,is_not_customer:0};Object(d.l)(c,s).then(function(e){e&&!e.error&&(m.toast.info(i("TOAST.UpdatePhoneSuccess")),Object(u.h)({phone:e.data.phone,country_code:e.data.country_code}),t.setState({verifying:!1,otpSending:!1}))}).catch(function(e){m.toast.error(Object(S.n)(e.message))})}}},{key:"validateDob",value:function(e){if(!/^(0?[1-9]|[12][0-9]|3[01])[\/](0?[1-9]|1[012])[\/]\d{4}$/.test(e))return!1;var t=e.split("/");if((2==+t[1]||4==+t[1]||6==+t[1]||8==+t[1]||11==+t[1])&&30<+t[0])return!1;if(2==+t[1]){if(+t[2]%4==0&&29<+t[0])return!1;if(+t[2]%4!=0&&28<+t[0])return!1}return!0}},{key:"onUpdateDetail",value:function(){var e=this.state,t=e.name,n=e.email,a=e.dob,o=e.gender,r=e.error;if(!(0<Object.keys(r).length)){var i=this.props,s=i.t,c=i.token,l=i.updateCustomer;if(this.dobRef.value&&!this.validateDob(this.dobRef.value)||a&&!this.dobRef.value)m.toast.error(s("VALIDATE.DATE_OF_BIRTH_NOT_VALID"));else{var u={gender:o};t&&(u.name=t),a&&(u.dob=a),n&&(u.email=n),Object(d.j)(u,c).then(function(e){e&&!e.error&&(m.toast.info(s("TOAST.updateCustomerSuccessfully")),l(u))}).catch(function(e){m.toast.error(Object(S.n)(e.message))})}}}},{key:"onSelectDob",value:function(e){e&&this.setState({originDob:D()(e).format(this.formatDateApi),dob:D()(e).format(this.formatDateApi)})}},{key:"onDobChange",value:function(e){var t=this,n=e.target;if(n){this.timeout&&clearTimeout(this.timeout);var a=this.state.originDob,o=this;this.timeout=setTimeout(function(){var e=n.value;D()(e,t.formatDate,!0).isValid()?o.setState({originDob:D()(e,t.formatDate).format(t.formatDateApi),dob:D()(e,t.formatDate).format(t.formatDateApi)}):o.setState({dob:a})},500)}}},{key:"showGender",value:function(){this.setState({genderOpened:!0})}},{key:"changeGender",value:function(e){this.state.gender!==e&&this.setState({gender:e,genderOpened:!1})}},{key:"render",value:function(){var a=this,e=this.props,t=e.t,n=e.lang,o=(e.router.location.pathname,this.state),r=o.phone,i=o.name,s=o.email,c=o.dob,l=o.gender,u=o.otp,m=o.countryCode,d=o.countriesListShow,h=o.otpSending,p=o.verifying,f=o.error,b=o.phoneChanged,g=o.genderOpened,v=S.k.find(function(e){return e.country_code===m}),y=0<Object.keys(f).length;return E.a.createElement("div",{className:"profile"},E.a.createElement("div",{className:"container"},E.a.createElement("div",{className:"row"},E.a.createElement("div",{className:"info"},E.a.createElement("h3",null,t("LABEL.MY_DETAIL")),E.a.createElement("div",{className:"info-row"},E.a.createElement("label",null,t("LABEL.PHONE")),E.a.createElement("div",{className:"phone-wrapper ".concat(h?"otpSending":"")},!h&&E.a.createElement("input",{type:"text",name:"phone",value:r,className:"border-bottom",maxLength:20,onChange:this.handleInputChange}),!h&&E.a.createElement("div",{className:"countries-data"},E.a.createElement("div",{className:"countries-toggle",ref:function(e){return a.countryToggle=e},onClick:function(){return a.toggleCountriesList()}},E.a.createElement(C.a,{code:v.alpha2,svg:!0}),"+ ",v.country_code,E.a.createElement("i",{className:"icon-hottab-angle-".concat(d?"up":"down")})),d&&E.a.createElement("div",{className:"countries-wrapper",ref:function(e){return a.countriesRef=e}},S.k.map(function(e,t){var n=e.country_code===m;return E.a.createElement("div",{className:"country cleafix ".concat(n?"selected":""),onClick:function(){return a.changeCountryCode(e.country_code)},key:t},e.alpha2&&E.a.createElement(C.a,{code:e.alpha2,svg:!0}),E.a.createElement("div",{className:"country-name"},e.name),E.a.createElement("div",{className:"country-code"},"+ ",e.country_code))}))),h&&E.a.createElement("input",{type:"text",name:"otp",value:u,maxLength:20,placeholder:t("PLACEHOLDER.SEND_OTP"),className:"border-bottom",onChange:this.handleInputChange}),b&&!h&&r&&E.a.createElement("button",{className:"btn btn-type-2 btn-submit",disabled:h,onClick:function(){return a.sendOtp()}},t("BUTTON.SEND_OTP")),h&&E.a.createElement("button",{className:"btn btn-type-2 btn-submit",disabled:p,onClick:function(){return a.verify()}},t("BUTTON.SEND_OTP")))),E.a.createElement("div",{className:"info-row"},E.a.createElement("label",null,t("LABEL.FULL_NAME")),E.a.createElement("input",{type:"text",name:"name",value:i,maxLength:60,className:"border-bottom",onChange:this.handleInputChange})),E.a.createElement("div",{className:"info-row"},E.a.createElement("label",null,t("LABEL.EMAIL")),E.a.createElement("div",null,E.a.createElement("input",{type:"text",name:"email",maxLength:191,value:s,className:"border-bottom",onChange:this.handleInputChange}),f.email&&E.a.createElement("div",{className:"error-message"},f.email))),E.a.createElement("div",{className:"info-row"},E.a.createElement("label",null,t("LABEL.DOB")),E.a.createElement("div",{className:"dob-input"},E.a.createElement(L.a,{formatDate:O.formatDate,parseDate:O.parseDate,onDayChange:function(e){return a.onSelectDob(e)},format:this.formatDateApi,value:c?D()(c,this.formatDateApi).format(this.formatDate):"",placeholder:"",dayPickerProps:{month:c?new Date(c):new Date(1989,12),locale:n,localeUtils:k.a},inputProps:{onChange:this.onDobChange,ref:function(e){return a.dobRef=e}}}),E.a.createElement("i",{className:"icon-hottab-calendar abs-icon"}))),E.a.createElement("div",{className:"info-row"},E.a.createElement("label",null,t("LABEL.GENDER")),E.a.createElement("div",{className:"gender-input"},E.a.createElement("input",{ref:function(e){return a.genderInputRef=e},type:"text",name:"gender",value:t(1===l?"LABEL.MALE":"LABEL.FEMALE"),className:"border-bottom",onClick:this.showGender}),E.a.createElement("i",{className:"icon-hottab-angle-down abs-icon"}),g&&E.a.createElement("div",{className:"gender-dropdown",ref:function(e){return a.genderRef=e}},E.a.createElement("ul",null,E.a.createElement("li",{onClick:function(){return a.changeGender(1)},className:"".concat(1===l?"selected":"")},E.a.createElement("span",null,t("LABEL.MALE"),E.a.createElement("i",{className:"icon-hottab-check-solid"}))),E.a.createElement("li",{onClick:function(){return a.changeGender(2)},className:"".concat(2===l?"selected":"")},E.a.createElement("span",null,t("LABEL.FEMALE"),E.a.createElement("i",{className:"icon-hottab-check-solid"}))))))),E.a.createElement("div",{className:"info-row"},E.a.createElement("label",null,"Â "),E.a.createElement("button",{className:"btn btn-type-2 btn-update uppercase",disabled:y,onClick:this.onUpdateDetail},t("BUTTON.UPDATE")))))))}}])&&p(t.prototype,n),a&&p(t,a),o}())||a)||a;t.default=v}}]);